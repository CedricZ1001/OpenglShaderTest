# GmaeEngine

![](GameEngine.jpg)

# OpenGL 渲染管线

OpenGL 的渲染管线是图形渲染过程中的一系列步骤，用于将 3D 场景中的物体转换成最终呈现在屏幕上的 2D 图像。OpenGL 的渲染管线分为两个阶段：几何阶段和光栅化阶段。以下是 OpenGL 渲染管线的主要步骤及其细节：

![](evasgl-graphics-pipeline.png)

## 几何阶段（Geometry Stage）

1. **顶点着色器（Vertex Shader）：**

   - 将 3D 场景中的顶点坐标转换成裁剪坐标（Clip Space）。
   - 顶点着色器是一个自定义的程序，可执行各种变换和计算。

2. **图元装配（Primitive Assembly）：**

   - 将顶点组装成图元（如点、线段、三角形）。
   - 多个顶点通常组成一个图元。

3. **几何着色器（Geometry Shader）（可选）：**

   - 可选的程序，用于进一步处理几何图元。
   - 用于执行粒子系统、几何细分、体积渲染等任务。

4. **裁剪（Clipping）：**

   - 将图元裁剪为可见部分，避免渲染不可见的图元。

5. **透视除法和视口变换：**
   - 将裁剪坐标转换为标准化设备坐标（NDC），执行透视除法操作。
   - 视口变换将 NDC 坐标映射到屏幕坐标。

## 光栅化阶段（Rasterization Stage）

6. **光栅化（Rasterization）：**

   - 确定每个图元覆盖了屏幕上的哪些像素。
   - 将图元转换为像素片段。

7. **片段着色器（Fragment Shader）：**

   - 计算每个像素片段的最终颜色。
   - 通常执行光照计算、纹理采样等任务。

8. **模板测试和深度测试：**

   - 确定哪些片段将被写入帧缓冲，进行遮挡和深度测试。

9. **混合（Blending）：**

   - 将片段颜色与帧缓冲中的颜色混合，生成最终像素颜色。

10. **输出到帧缓冲：**
    - 渲染结果写入帧缓冲，然后显示在屏幕上。

![](ue4_pipeline.png)

# UE4 RENDERING PIPELINE 

### 1. 场景设置和准备： 渲染管线的第一步是设置场景并准备渲染所需的资源，包括场景中的模型、纹理、材质、光源和相机设置。

### 2. 几何和光栅化阶段：

- a. 顶点着色器（Vertex Shader）： UE4 的渲染管线从顶点着色器开始，它负责对场景中的顶点进行变换和变换后的位置计算。这包括模型的变换、摄像机视图变换和投影变换。

- b. 图元装配（Primitive Assembly）： 在这个阶段，顶点被组装成几何图元，如三角形或线段。

- c. 几何着色器（Geometry Shader，可选）： 如果需要，几何着色器可以用于执行额外的几何操作，如创建粒子效果或几何细分。

- d. 光栅化（Rasterization）： 在这一步中，几何图元被转换为屏幕空间的片段（像素）。

### 3. 像素着色器（Pixel Shader）： 在像素着色器阶段，每个片段都会进行像素级的着色计算。这包括计算材质纹理的颜色、光照计算、阴影计算等等。UE4 的着色器系统非常灵活，允许开发人员编写自定义的像素着色器来实现特定效果。

### 4. 像素深度测试： 在像素深度测试阶段，UE4 执行深度测试以确定哪些像素应该被写入深度缓冲区。这确保了前后遮挡关系的正确性。

### 5. 提交和合成： 已经通过深度测试的像素将被提交和合成到帧缓冲区中。这包括颜色和深度信息的写入，以及可能的后处理效果，如全屏抗锯齿、HDR 合成等。

### 6. UI 渲染： 最后，UE4 渲染管线还包括 UI 渲染阶段，它负责绘制用户界面元素，如 HUD（Heads-Up Display）。

### 7. 输出到屏幕： 渲染管线完成后，渲染结果将被输出到屏幕上，呈现给玩家。

需要注意的是，UE4 的渲染管线非常复杂，还包括许多其他功能和优化，如多重采样抗锯齿、动态阴影、屏幕空间反射等等。此外，UE4 还支持各种平台和图形 API，如 DirectX 和 OpenGL，以确保跨平台的兼容性。


# UE4 渲染管线

